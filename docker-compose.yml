version: "3.7"
services:
  # mongodb:
  #   image: mongo
  #   container_name: mongodb
  #   environment:
  #     - PUID=1000
  #     - PGID=1000
  #   ports:
  #     - 27017:27017

  cache:
    image: redis:7.2
    ports:
      - "6379:6379"

  # jaeger:
  #   image: jaegertracing/opentelemetry-all-in-one:latest
  #   ports:
  #     - 16686:16686
  #     - 13133:13133
  #     - 4317:4317
  #     - 4318:4318

  # local.api:
  #   image: plant-based-pizza-monolith
  #   container_name: local.pizza-api
  #   ports:
  #     - "5051:8080"
  #   environment:
  #     - DatabaseConnection=mongodb://mongodb:27017
  #     - OtlpEndpoint=http://jaeger:4317
  #     - Environment=local
  #     - Services__Loyalty=http://local.loyalty-api:8080

  # api-dapr:
  #   image: "daprio/daprd:edge"
  #   command: [
  #       "./daprd",
  #       "--app-id",
  #       "monolith",
  #       "--app-port",
  #       "8080",
  #       "--placement-host-address",
  #       "placement:50006", # Dapr's placement service can be reach via the docker DNS entry
  #       "--dapr-grpc-port",
  #       "5101",
  #       "--resources-path",
  #       "./components",
  #     ]
  #   volumes:
  #     - "./components/:/components" # Mount our components folder for the runtime to use. The mounted location must match the --resources-path argument.
  #   depends_on:
  #     - "local.api"
  #   network_mode: "service:local.api"

  # local.loyalty-api:
  #   image: plant-based-pizza-loyalty-service
  #   container_name: local.loyalty-api
  #   ports:
  #     - "5050:8080"
  #   environment:
  #     - DatabaseConnection=mongodb://mongodb:27017
  #     - OtlpEndpoint=http://jaeger:4317
  #     - Environment=local

  # loyalty-dapr:
  #   image: "daprio/daprd:edge"
  #   command: [
  #       "./daprd",
  #       "--app-id",
  #       "loyalty",
  #       "--app-port",
  #       "8080",
  #       "--placement-host-address",
  #       "placement:50006", # Dapr's placement service can be reach via the docker DNS entry
  #       "--dapr-grpc-port",
  #       "5101",
  #       "--resources-path",
  #       "./components",
  #     ]
  #   volumes:
  #     - "./components/:/components" # Mount our components folder for the runtime to use. The mounted location must match the --resources-path argument.
  #   depends_on:
  #     - "local.loyalty-api"
  #   network_mode: "service:local.loyalty-api"
  
  # # reverse-proxy:
  # #   image: nginx:latest
  # #   ports:
  # #     - "8080:80"  # Map port 80 of the container to port 8080 on the host
  # #   volumes:
  # #     - ./nginx/nginx-custom.conf:/etc/nginx/conf.d/default.conf:ro
  # #   depends_on:
  # #     - local.api
  # #     - local.loyalty-api

  # ############################
  # # Dapr placement service
  # ############################
  # placement:
  #   image: "daprio/dapr"
  #   command: ["./placement", "-port", "50006"]
  #   ports:
  #     - "50006:50006"